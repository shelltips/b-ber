'use strict';var express=require('express'),esindex=require('serve-index'),path=require('path'),bunyan=require('bunyan'),bformat=require('bunyan-format'),cwd=process.cwd(),formatOut=bformat({outputMode:'short'}),log=bunyan.createLogger({name:'bber',stream:formatOut,level:'debug'}),args={};process.argv.forEach(function(a){var b=a.split(' ');return args[b[0]]=b[1]});var port=+args['--port']||3e3,dir=4e3===port?path.join(cwd,'book/OPS'):path.join(cwd,'_site'),hidden=['.opf','.ncx'],opts={filter:function filter(a){return-1===hidden.indexOf(path.extname(a))}},app=express();app.use(express.static(dir)),4e3===port&&app.use(esindex(dir,opts)),app.listen(port,function(){log.info('Server is running at localhost: '+port)});